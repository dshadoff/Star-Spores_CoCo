00001 	ORG	$5AA6
00002 LINE	PSHS	Y,X,B,A
00003 	LDA	STARTX
00004 	SUBA	ENDX
00005 	BNE	LINE1
00006 	LDA	STARTY
00007 	SUBA	ENDY
00008 	BNE	LINE1
00009 	JSR	SET
00010 	PULS	A,B,X,Y,PC
00011 LINE1	LDD	ENDX
00012 	TFR	A,B
00013 	CLRA
00014 	STD	STO1
00015 	LDD	STARTX
00016 	TFR	A,B
00017 	CLRA
00018 	STD	D1
00019 	LDD	STO1
00020 	SUBD	D1
00021 	STD	DIRX
00022 	LDD	ENDY
00023 	TFR	A,B
00024 	CLRA
00025 	STD	STO1
00026 	LDD	STARTY
00027 	TFR	A,B
00028 	CLRA
00029 	STD	D1
00030 	LDD	STO1
00031 	SUBD	D1
00032 	STD	DIRY
00033 	TFR	D,X
00034 	LDD	D1
00035 	STD	STO1
00036 	STX	D1
00037 	LDD	DIRX
00038 	STD	STO1
00039 	LDA	STO2
00040 	ANDA	#$80
00041 	STA	STO5
00042 	LDA	STO3
00043 	ANDA	#$80
00044 	STA	STO4
00045 SHIFT	ASL	STO2
00046 	ASL	STO3
00047 	LDA	STO2
00048 	ANDA	#$80
00049 	CMPA	STO5
00050 	BNE	DSHIFT
00051 	LDA	STO3
00052 	ANDA	#$80
00053 	CMPA	STO4
00054 	BEQ	SHIFT
00055 DSHIFT	LDD	STO1
00056 	STD	DIRX
00057 	LDD	D1
00058 	STD	DIRY
00059 NXTBLO	JSR	SET
00060 	LDD	ENDX
00061 	SUBD	STARTX
00062 	BEQ	MAYBE
00063 NOTYET	LDD	STARTX
00064 	ADDD	DIRX
00065 	STD	STARTX
00066 	LDD	STARTY
00067 	ADDD	DIRY
00068 	STD	STARTY
00069 	BRA	NXTBLO
00070 MAYBE	LDD	ENDY
00071 	SUBD	STARTY
00072 	BNE	NOTYET
00073 	PULS	A,B,X,Y,PC
00074 SET	PSHS	Y,X,B,A
00075 	LDD	STARTX
00076 	BITB	#$80
00077 	BEQ	NOINC
00078 	INCA
00079 NOINC	STA	XPOS
00080 	LDD	STARTY
00081 	BITB	#$80
00082 	BEQ	NOINC1
00083 	INCA
00084 NOINC1	STA	YPOS
00085 	LDB	YPOS
00086 	CLRA
00087 	LSRB
00088 	LSRB
00089 	INCB
00090 	STD	$5CF2
00091 	STD	$5D03
00092 	TST	COLOR
00093 	BEQ	NOSOND
00094 	JSR	$5CC8
00095 	JSR	$5CC8
00096 NOSOND	LDX	$5D8D
00097 	LDB	YPOS
00098 	LDA	#$20
00099 	MUL
00100 	LEAX	D,X
00101 	LDA	XPOS
00102 	TFR	A,B
00103 	ANDA	#3
00104 	NOP
00105 	LSRB
00106 	LSRB
00107 	ABX
00108 	LDY	#TABLE
00109 	LDA	A,Y
00110 	TFR	A,B
00111 	COMB
00112 	ANDB	,X
00113 	ANDA	COLOR
00114 	STA	,-S
00115 	ORB	,S+
00116 	STB	,X
00117 	PULS	A,B,X,Y,PC
00118 TABLE	FCB	$C0
00119 	FCB	$30
00120 	FCB	$0C
00121 	FCB	$03
00122 	RMB	4
00123 ENDY	FDB	0
00124 ENDX	FDB	0
00125 STARTX	FDB	0
00126 STARTY	FDB	0
00127 DIRX	FDB	0
00128 DIRY	FDB	0
00129 XPOS	FCB	0
00130 YPOS	FCB	0
00131 COLOR	FCB	0
00132 STO5	FCB	0
00133 STO4	FCB	0
00134 D1	FCB	0
00135 STO3	FCB	0
00136 STO1	FCB	0
00137 STO2	FCB	0
00138 	END	LINE
